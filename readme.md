# LapApp Ver2

トラック計測データからKPI（Key Performance Indicators）を計算・表示するアプリケーションです。

## クイックスタート

### 1. 選手リストの取得

1. **Start Date** と **End Date** を設定（JST形式）
2. **Get players list** ボタンをクリック
3. 指定期間内にデータがある選手がリストに表示されます

### 2. KPIの表示

1. 選手リストから1人以上を選択（複数選択可）
2. **Show KPIs** ボタンをクリック
3. KPIページが開き、エフォート（effort）ごとのKPIが表示されます

### 3. KPIページの操作

- **モード切替**: Rolling / Standing / Flying を選択（表示されるKPI列が変わります）
- **エフォート一覧**: 各エフォートのKPI値と周回数が表示されます
- **生データ確認**: エフォートを選択して **View Raw Data for Selected Effort** をクリック
- **更新**: **Update to Latest** ボタンで最新データを取得
- **KPI設定編集**: **Edit KPI Setting** ボタンでKPIの定義を編集

## 主要なロジック

### エフォート検出

エフォート（effort）は以下のルールで自動検出されます：

1. **起点**: 0m地点を検出
2. **開始点**: 起点0mから5秒前の範囲でSB1またはFPを検出
   - SB1が優先、なければFPを使用
   - 見つからない場合はエフォートとして扱わない
3. **終了点**: 開始点から30秒以内のFPを順に追跡し、最後のFPから30秒後までをエフォートとして確定

### KPI計算

KPIは `kpi.json` で定義された区間（start-end）の時間差を計算します：

- **start/end**: トラック上の位置（FP, SB1, 0m, 60m, AP1, 50m, 100m, BP, 150m, AP2, 200m）
- **オフセット**: `+1` のように指定すると、次の周回の位置を使用（例: `0m+1` = 次の周回の0m）
- **モード**: Rolling / Standing / Flying ごとに異なるKPI定義を使用

### 生データビュー

エフォートの生データは、各周回ごとに1行として表示されます：
- 列: FP, SB1, 0m, 60m, AP1, 50m, 100m, BP, 150m, AP2, 200m
- 値: 各位置の通過時刻（timestamp）

## 設定ファイル

- **settings.json**: データベース接続情報、UI設定など
- **kpi.json**: KPI定義（各モードごとのstart-end区間）

## ライセンス

アプリ起動時にライセンス認証が必要です。`license.txt` ファイルにライセンスキーを記載するか、起動時に手動入力してください。
